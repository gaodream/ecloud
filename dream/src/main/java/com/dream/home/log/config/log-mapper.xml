<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dream.home.log.dao.LogDAO">
	<!--1.查询条件-->
	<sql id="SQL_CONDITION">
		<if test="rowId != null and rowId != '' ">
		 and sml.row_id = #{rowId}
		</if>
		<if test="requestUrl != null and requestUrl != '' ">
		 and sml.request_url = #{requestUrl}
		</if>
		<if test="requestIp != null and requestIp != '' ">
		 and sml.request_ip = #{requestIp}
		</if>
		<if test="methodName != null and methodName != '' ">
		 and sml.method_name = #{methodName}
		</if>
		<if test="methodArgs != null and methodArgs != '' ">
		 and sml.method_args = #{methodArgs}
		</if>
		<if test="requestTime != null and requestTime != '' ">
		 and sml.request_time = #{requestTime}
		</if>
	</sql>

	<!--2.查询内容-->
	<sql id="SQL_CONTENT">
		sml.row_id rowId,
		sml.request_url requestUrl,
		sml.request_ip requestIp,
		sml.method_name methodName,
		sml.method_args methodArgs,
		sml.request_time requestTime
	</sql>

	<!--3.查询记录数-->
	<select id="doSearchCount" parameterType="LogVO" resultType="java.lang.Integer">
		SELECT COUNT(0) AS _COUNT FROM sm_log sml WHERE 1=1 AND DELETED_FLAG = 'N'
		<include refid="SQL_CONDITION"/>
	</select>

	<!--4.按条件查询记录-->
	<select id="doSearchListByVO" parameterType="LogVO"  resultType="LogVO"> 
		SELECT 
			<include refid="SQL_CONTENT"/>
		FROM sm_log sml  WHERE sml.DELETED_FLAG = 'N' 
			<include refid="SQL_CONDITION"/>
	</select>

	<!--5.根据ID查询记录-->
	<select id="doFindById" parameterType="LogVO"  resultType="LogVO">  
		SELECT 
		<include refid="SQL_CONTENT"/>
		FROM sm_log sml 
		WHERE sml.DELETED_FLAG = 'N' AND  sml.ROW_ID = #{value} 
	</select>

	<!--6.按照VO插入-->
	<insert  id="doInsertByVO"  parameterType="LogVO"> 
		<selectKey resultType="java.lang.Long" order="BEFORE" keyProperty="rowId">
			SELECT E_SEQ('sm_log') AS rowId FROM DUAL
		</selectKey>
		INSERT INTO sm_log(row_id,request_url,request_ip,method_name,method_args,request_time)
		VALUES(#{rowId},#{requestUrl},#{requestIp},#{methodName},#{methodArgs},NOW())
	 </insert>

	<!--7.批量插入-->
	<insert  id="doBatchInsertByList"  parameterType="java.util.List"> 
		INSERT INTO sm_log(row_id,request_url,request_ip,method_name,method_args,request_time)
		VALUES
		<foreach collection="list" item="item" index="index" separator="," >
			(#E_SEQ('sm_log'),#{item.requestUrl},#{item.requestIp},#{item.methodName},#{item.methodArgs},#{item.requestTime})
		</foreach>
	</insert>

	<!--8.按主键逻辑删除-->
	<update id="doDeleteById"  parameterType="Long"> 
		UPDATE  sm_log sml SET sml.DELETED_FLAG = 'Y'  WHERE 1=1   AND sml.ROW_ID = #{value} 
	</update>

	<!--9.按复合条件逻辑更新-->
	<update  id="doUpdateByVO"  parameterType="LogVO"> 
		UPDATE   sm_log  
		<set>
			<if test="rowId != null">row_id=#{rowId},</if>
			<if test="requestUrl != null">request_url=#{requestUrl},</if>
			<if test="requestIp != null">request_ip=#{requestIp},</if>
			<if test="methodName != null">method_name=#{methodName},</if>
			<if test="methodArgs != null">method_args=#{methodArgs},</if>
			<if test="requestTime != null">request_time=#{requestTime}</if>
		</set>
		WHERE  ROW_ID = #{rowId}
	</update>

	<!--10.批量修改-->
	<update id="doBatchUpdateByList"  parameterType="java.util.List">
		INSERT INTO sm_log(row_id,request_url,request_ip,method_name,method_args,request_time)
		VALUES
		<foreach collection="list" item="item" index="index" separator="," >
			(#{item.rowId},#{item.requestUrl},#{item.requestIp},#{item.methodName},#{item.methodArgs},#{item.requestTime})
		</foreach>
		ON DUPLICATE KEY UPDATE   
			row_id = VALUES(row_id),
			request_url = VALUES(request_url),
			request_ip = VALUES(request_ip),
			method_name = VALUES(method_name),
			method_args = VALUES(method_args),
			request_time = VALUES(request_time)
	</update>
</mapper>
